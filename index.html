<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dragon Hunt</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      text-align: center;
      background: #111;
      color: white;
    }
    #game-frame {
      width: 90vw;
      height: 80vh;
      margin: 0 auto;
      overflow: hidden;
      border: 2px solid #444;
      position: relative;
      cursor: grab;
      touch-action: none;
    }
    #game-container {
      position: absolute;
      top: 0;
      left: 0;
      transform-origin: top left;
      z-index: 1;
    }
    #game {
      position: relative;
      display: inline-block;
    }
    #mainImage {
      width: 100%;
      height: auto;
      display: block;
      touch-action: none;
      user-select: none;
      -webkit-user-drag: none;
    }
    #scoreboard {
      margin: 10px;
      font-size: 1.2em;
      z-index: 3;
    }
    #complete {
      font-size: 3em;
      color: white;
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.7);
      padding: 20px 40px;
      border-radius: 10px;
      z-index: 2;
      pointer-events: none;
    }
    .marker {
      position: absolute;
      border: 3px solid lime;
      border-radius: 50%;
      pointer-events: none;
      box-shadow: 0 0 10px lime;
      z-index: 1;
    }
    .hidden-marker {
      display: none;
    }
    .faded {
      opacity: 0.3;
    }
    .zoom-controls {
      margin: 10px;
      z-index: 3;
    }
    .zoom-controls button {
      font-size: 1em;
      padding: 5px 10px;
      margin: 0 5px;
    }
    .reset-controls {
      margin: 10px;
      z-index: 3;
    }
    .reset-controls button {
      font-size: 1em;
      padding: 5px 10px;
    }
  </style>
</head>
<body>
  <h1>üêâ Dragon Hunt</h1>
  <div id="scoreboard">Score: <span id="score">0</span> | Time: <span id="timer">00:00:00</span></div>
  <div class="zoom-controls">
    <button onclick="zoom(1.2)">Zoom In</button>
    <button onclick="zoom(0.8)">Zoom Out</button>
    <button onclick="resetZoom()">Reset</button>
  </div>
  <div class="reset-controls">
    <button onclick="resetGame()">Restart Game</button>
  </div>
  <div id="game-frame">
    <div id="game-container">
      <div id="game">
        <img id="mainImage" src="images/dragons.jpg" usemap="#image-map" alt="Dragon Garden" />
        <!-- Image Map Generated by http://www.image-map.net/ -->
        <map name="image-map">
          <area target="" alt="1"  title="1"  coords="1359,342,143" shape="circle">
          <area target="" alt="2"  title="2"  coords="854,1282,28"  shape="circle">
          <area target="" alt="3"  title="3"  coords="320,1180,14"  shape="circle">
          <area target="" alt="4"  title="4"  coords="309,902,13"   shape="circle">
          <area target="" alt="5"  title="5"  coords="463,748,11"   shape="circle">
          <area target="" alt="6"  title="6"  coords="630,917,13"   shape="circle">
          <area target="" alt="7"  title="7"  coords="574,664,11"   shape="circle">
          <area target="" alt="8"  title="8"  coords="597,551,9"    shape="circle">
          <area target="" alt="9"  title="9"  coords="554,491,9"    shape="circle">
          <area target="" alt="10" title="10" coords="570,337,11"   shape="circle">
          <area target="" alt="11" title="11" coords="651,509,10"   shape="circle">
          <area target="" alt="12" title="12" coords="693,747,11"   shape="circle">
          <area target="" alt="13" title="13" coords="807,791,11"   shape="circle">
          <area target="" alt="14" title="14" coords="807,711,13"   shape="circle">
          <area target="" alt="15" title="15" coords="751,563,8"    shape="circle">
          <area target="" alt="16" title="16" coords="771,474,11"   shape="circle">
          <area target="" alt="17" title="17" coords="845,588,11"   shape="circle">
          <area target="" alt="18" title="18" coords="912,921,13"   shape="circle">
          <area target="" alt="19" title="19" coords="999,765,14"   shape="circle">
          <area target="" alt="20" title="20" coords="986,546,10"   shape="circle">
          <area target="" alt="21" title="21" coords="955,501,7"    shape="circle">
          <area target="" alt="22" title="22" coords="1147,921,11"  shape="circle">
          <area target="" alt="23" title="23" coords="1169,799,11"  shape="circle">
          <area target="" alt="24" title="24" coords="1180,703,11"  shape="circle">
          <area target="" alt="25" title="25" coords="1209,761,9"   shape="circle">
          <area target="" alt="26" title="26" coords="1136,414,7"   shape="circle">
          <area target="" alt="27" title="27" coords="1265,472,5"   shape="circle">
          <area target="" alt="28" title="28" coords="1418,937,11"  shape="circle">
          <area target="" alt="29" title="29" coords="1313,633,5"   shape="circle">
          <area target="" alt="30" title="30" coords="1455,641,8"   shape="circle">
          <area target="" alt="31" title="31" coords="1458,869,9"   shape="circle">
          <area target="" alt="32" title="32" coords="1505,1034,11" shape="circle">
          <area target="" alt="33" title="33" coords="1628,888,11"  shape="circle">
          <area target="" alt="34" title="34" coords="1585,550,10"  shape="circle">
          <area target="" alt="35" title="35" coords="1617,498,12"  shape="circle">
          <area target="" alt="36" title="36" coords="1652,702,8"   shape="circle">
          <area target="" alt="37" title="37" coords="1795,722,9"   shape="circle">
          <area target="" alt="38" title="38" coords="1878,682,11"  shape="circle">
          <area target="" alt="39" title="39" coords="2017,937,11"  shape="circle">
          <area target="" alt="40" title="40" coords="2028,752,9"   shape="circle">
          <area target="" alt="41" title="41" coords="1974,560,10"  shape="circle">
          <area target="" alt="42" title="42" coords="1323,541,9"   shape="circle">
        </map>
        <div id="complete">Placeholder (page broke :C)</div>
    </div>
  </div>
  <script>
    const areas = document.querySelectorAll('area[shape="circle"]');
    const scoreSpan = document.getElementById('score');
    const timerSpan = document.getElementById('timer');
    const image = document.getElementById('mainImage');
    const complete = document.getElementById('complete');
    const game = document.getElementById('game');
    const container = document.getElementById('game-container');
    const frame = document.getElementById('game-frame');
    let score = parseInt(localStorage.getItem('dragon_score')) || 0;
    let timer = parseInt(localStorage.getItem('dragon_timer')) || 0;
    let zoomLevel = 1;
    let offsetX = 0, offsetY = 0;
    let isPanning = false, startX = 0, startY = 0;
    let velocityX = 0, velocityY = 0;
    let momentumId = null;

    scoreSpan.textContent = score;
    timerSpan.textContent = formatTime(timer);

    function formatTime(seconds) {
      const hrs = Math.floor(seconds / 3600);
      const mins = Math.floor((seconds % 3600) / 60);
      const secs = seconds % 60;
      return [hrs, mins, secs]
        .map(unit => unit < 10 ? '0' + unit : unit)
        .join(':');
    }

    function zoom(factor) {
      zoomLevel = Math.max(0.5, Math.min(zoomLevel * factor, 5));
      applyTransform();
    }

    function resetZoom() {
      zoomLevel = 1;
      offsetX = 0;
      offsetY = 0;
      applyTransform();
    }

    function applyTransform() {
      container.style.transform = `scale(${zoomLevel}) translate(${offsetX}px, ${offsetY}px)`;
    }

    let interval = setInterval(() => {
      timer++;
      timerSpan.textContent = formatTime(timer);
      localStorage.setItem('dragon_timer', timer);
    }, 1000);

    areas.forEach(area => {
      if (area.dataset.found === 'true') return;

      area.addEventListener('click', (e) => {
        e.preventDefault();
        if (!area.dataset.found) {
          area.dataset.found = 'true';
          score++;
          scoreSpan.textContent = score;
          localStorage.setItem('dragon_score', score);

          const coords = area.coords.split(',');
          const x = parseInt(coords[0]);
          const y = parseInt(coords[1]);
          const r = parseInt(coords[2]);

          const marker = document.createElement('div');
          marker.className = 'marker';
          marker.style.width = `${r * 2}px`;
          marker.style.height = `${r * 2}px`;
          marker.style.left = `${x - r}px`;
          marker.style.top = `${y - r}px`;
          game.appendChild(marker);

          if (score === areas.length) {
            clearInterval(interval);
            complete.style.display = 'block';
            image.classList.add('faded');
            document.querySelectorAll('.marker').forEach(m => m.classList.add('hidden-marker'));
            localStorage.removeItem('dragon_score');
            localStorage.removeItem('dragon_timer');
          }
        }
      });
    });

    function resetGame() {
      localStorage.removeItem('dragon_score');
      localStorage.removeItem('dragon_timer');
      location.reload();
    }

    function startMomentumScroll() {
      cancelAnimationFrame(momentumId);
      momentumId = requestAnimationFrame(function step() {
        if (Math.abs(velocityX) > 0.1 || Math.abs(velocityY) > 0.1) {
          offsetX += velocityX / zoomLevel;
          offsetY += velocityY / zoomLevel;
          velocityX *= 0.95;
          velocityY *= 0.95;
          applyTransform();
          momentumId = requestAnimationFrame(step);
        }
      });
    }

    frame.addEventListener('mousedown', (e) => {
      isPanning = true;
      frame.style.cursor = 'grabbing';
      startX = e.clientX;
      startY = e.clientY;
      velocityX = 0;
      velocityY = 0;
      cancelAnimationFrame(momentumId);
    });

    frame.addEventListener('mouseup', (e) => {
      isPanning = false;
      frame.style.cursor = 'grab';
      startMomentumScroll();
    });

    frame.addEventListener('mouseleave', () => {
      isPanning = false;
      frame.style.cursor = 'grab';
    });

    frame.addEventListener('mousemove', (e) => {
      if (!isPanning) return;
      const dx = (e.clientX - startX);
      const dy = (e.clientY - startY);
      offsetX += dx / zoomLevel;
      offsetY += dy / zoomLevel;
      velocityX = dx;
      velocityY = dy;
      applyTransform();
      startX = e.clientX;
      startY = e.clientY;
    });

    frame.addEventListener('touchstart', (e) => {
      if (e.touches.length !== 1) return;
      isPanning = true;
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
      cancelAnimationFrame(momentumId);
    });

    frame.addEventListener('touchend', () => {
      isPanning = false;
      startMomentumScroll();
    });

    frame.addEventListener('touchmove', (e) => {
      if (!isPanning || e.touches.length !== 1) return;
      const dx = e.touches[0].clientX - startX;
      const dy = e.touches[0].clientY - startY;
      offsetX += dx / zoomLevel;
      offsetY += dy / zoomLevel;
      velocityX = dx;
      velocityY = dy;
      applyTransform();
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
      e.preventDefault();
    }, { passive: false });
  </script>
</body>
</html>
